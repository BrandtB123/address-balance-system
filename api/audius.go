package api

import (
	"fmt"
	"unit410/db"
	"unit410/models"
)

type AudiusAPI struct{}

var addresses = []string{
	"0x28c6c06298d514db089934071355e5743bf21d60",
	"0x9f0c8e1f71cf4cd20310ecb685b4427565d9348c",
	"0xa305fab8bda7e1638235b054889b3217441dd645",
	"0xa76d26553e203f455a59ecece8bc6bfb054ce1cd",
	"0x6767526a362ec6c6b1df185478e4f01506b73ff3",
	"0xb0a6230d1c9780606df0530cfaba4f0ae7a31129",
	"0xdf2be39164499a1c261fa79ac6904ca0b573cc30",
	"0x93a94694c4b52348914de865c12950c3a2ce96f7",
	"0x6128d3a0c1a7eb957ac01a7e5935853f5653bfb4",
	"0xff537b493ab1665a026b895010c7c2cadf07f6a9",
	"0x3a1b9d1f8050ff2d6dc664af1a748736e45ede3b",
	"0x4cbc16f287e85b72e76e4df668ed30feaddff480",
	"0x29cde3de10e87887fe6a892e2a197ed16b24bb85",
	"0x4edc024d5454583095676ddf16e565dc11fdcb6e",
	"0xec62c1595696bb24edbf5d038cd257161c4a319f",
	"0xf05e2a70346560d3228c7002194bb7c5dc8fe100",
	"0x43f14f0d1a31d70fdbef7c4b1051deec626da70d",
	"0x56e17a54c128d12cc587de54eff311aac60f1f73",
	"0xdea365fc25c24d685d28ea70b51a67ae1537e907",
	"0x9df63a9472fe71762e8a780de17fb0fbbc56183a",
	"0x34d4c0e88e33c654aa2ec052d70b4aa3a1449b6d",
	"0xe83dde3eaa0622bb224b61e3dba8e00b3a96004f",
	"0x79f7e5c154c48923184e23117ddfd99e87b0fdb3",
	"0x3b690845fb93c5a791006d9c1b7a0318008067b6",
	"0xbdd61f425d6dcad8828ee7bc28ab94a2cbf3258e",
	"0x9e1f19a5c551e84e523810426a24ed4032902476",
	"0x125f660239707c9de3462d3fa633f2723ad0b884",
	"0xd859f3cb2612f40ee5f3d239da846ddc31189290",
	"0xd4c68828ba392beca6d3f33fdba37a23674d7788",
	"0xb9cca9ce1ef86430c3b9e06e5b2a3766580d3fc2",
	"0x51189523d8445971e90d42dd57bd839f46d75ed1",
	"0xbf92709b4747c14133fb8da981293ba7b43a5641",
	"0x2f230d89a7d59a53569470177374a6e4691b1af8",
	"0x4c0229b0e05ca3e40451dc58f997b0ead84d185e",
	"0x758272ef410e3d01832daefd6a4e78c55532b6f1",
	"0x61c3c93083c62d0fe83a837e4b2a8fc2abdfc94e",
	"0xba8f4fec035a2082da71f2f24e59cc8b4c3d1e42",
	"0xd0f60b77f4f625746c653ea9fa38e7a55da28c33",
	"0x191421b6f11c1f5d322a5cee53804de6f5df0078",
	"0xcd2935525a2df1698881a40c2165075f4616ef29",
	"0x61ab3d3637f27573bc5409f219cba6841e7bd18c",
	"0xc4aa841e5043745ab3a8296babeb36cb4e7fb6b2",
	"0x989a69a3e608483ae3f6fb21e2874f5c8fb98697",
	"0xb1f82f2393fa902b7e3f9b1d80e68741b018d115",
	"0xdb45adf74fbd18a2f101950e6c33147b2f584fd9",
	"0x98c632fd02f92d0c2d047db49ce2282c2a1812c8",
	"0xd4e585f3e6242bf212866a3ee5597d521a95713b",
	"0x90836913e1a77d0ff0c218965bda482e602e45c0",
	"0x06933312b94dcd323996a5001f61e0cdc1fbb355",
	"0x93604f5feed468936d1516ce3ee15a7d53de0f51",
	"0x9fc6fa84e74d1b98d21444deae2c5f5cdcb93774",
	"0xc8a1ca06440a9a06fae3785867686acf160c9702",
	"0xfb52b97e96ba7b139ad578f2c888b15e060f3ecf",
	"0x3f0c3faeeeb9dad6ef6eb5fbab61039ff9067a07",
	"0x3bc2b2bc5125eacdc64a8188b135a2997dd7324b",
	"0x55dcc55e6e520dbddf10c77bd029c99be5c69220",
	"0xb3df97f9365386a5dfce9e3afdef898a7165614b",
	"0x81a58058df9dc84106781ed18def2837eeee308c",
	"0x931e2e483c139d8fc416fa8f8646279938ed6f34",
	"0xe4e350a5f4afbbeded06293c16693ca1b80c82d6",
	"0xbb3fd383d1c5540e52ef0a7bcb9433375793aeaf",
	"0x383f73d5e1a6ecabad46ceb71390466efa939ba1",
	"0xcbb1e07b27c133a8e429a0edbc3b61ad31688bb1",
	"0x76f3f1352db57c8df3cb53fd540dd3cbbbbbb8f7",
	"0x3a59886ba78ac4a175b0236346e5bfab07963e48",
	"0xde3cbccdbf07b47a534dfd388d0e6453d03e4e58",
	"0x6c61cff1133b74d931bab771d4a8e04bde95a07c",
	"0x4c019d53715b8b1229a6d656246feac72121aa28",
	"0xed89da9dd83a0d703991ee833969489278b260e7",
	"0x0c1c41fe6e12c1274012f561964a4dedd7c4d12a",
	"0xe1f9d809ef1ea1b8f0559bf9cd5a0fe7b72f8ca5",
	"0x7078a08c0aad6eb86419364861b50f842aca5622",
	"0x244c15b911b3fab79ffba86f233db03e9af46817",
	"0x23d5d63e4866d184c4e118c6df85032e72a5d5fa",
	"0x0c97305bd07fc582bcc2042b9a2dedd9f451e75b",
	"0x28092c9b11a4517a0e5dabeab64dd223f0ec6bd2",
	"0x6ac800fba054d8e5e98c83c9ba9e80f618175339",
	"0xe896472739944ccc7cab3e2d2116bc79a30ec092",
	"0xf7bc8cca251960a9a73332b0f139e831b6452d75",
	"0x1dcf874b709b8f45b79aa55192bbcfd69afc625c",
	"0x655ced330b9325711b54ff9fc8342764c62e01b4",
	"0x97e3527b01ccae62c9919e0a52fba252c428c93f",
	"0xef7879ac3a236857c77f6becf2d4bcb110692cef",
	"0xa723a3455a5b886a99ed82f0166c811cf12713e3",
	"0xc1ec7c6a45a15ce5c8cbc81fe78b5cb7df07b9f6",
	"0xa7b567f8db7fe30b8d148d7873920a787794795c",
	"0xee845948e6806d12e966137caa07d49bbe632fe3",
	"0x1a20c03abc748bde9c563504c372297dd5c5ce8f",
	"0xf67adbe3943ddb1460fa5d9acf80da480e68bf0c",
	"0x54088a722fca457ba31499a19ed3894602b765e9",
	"0x61b7b515c1ec603cf21463bcac992b60fd610ca9",
	"0xa5132d1c58e5f691be5d266ab7ddbccfc8008837",
	"0xd7dd5ddb5c37071364fc524e1a1f71fd3cb04466",
	"0x7729f06209208b4486f83e07c2f6eb14331457da",
	"0xef15d12b8b935a432b681f317afd050f48dcbf85",
	"0x6f970464c4a889263916f9da49a6ad19c1972d2a",
	"0x5977dc0c0d17fed424118a303eb67db34514c15e",
	"0xa3de4fbc911e3174d990ce1110de517037bd5b14",
	"0x8850168c1ca862af3bf3bff058c5a866b86a6a89",
	"0x7a614e063d06e16b00869882d6c772ea13bdb614",
	"0x05c5273968bdac750494ff4b6c0440a43787f186",
	"0x09f8eb814a4f0e8e98ba24bb29b8fdc8c13a73a4",
	"0xadd0d1789e9672ba21db2f5806e14ecdeb2f6e21",
	"0xfb36f1f496dfb78f4d84f65a8c58a6475329be76",
	"0x1fb26304e31581c95445311f760c9150a66659af",
	"0x323212043329f0a9ce6a958ba62a154ffac5b627",
	"0x3f093bbf7ae2b20d0beb01f7baa8edaffb9691ed",
	"0x410ed1cbcea3b3990a3f27362c06c3c5d1e75d08",
	"0x455338ccdf1232f234dd12ba3e2b6795c374bb60",
	"0x805e7af141826209b66e74124b9763e2c61e5168",
	"0x576cd51be5b8ebb977bb5753bc60c33cc9aaaccc",
	"0xa67c3ea2877140dd2274f7da79cec336d8f4683b",
	"0x18fcf7e7bb6dffda16f0fc2ae9597472417db162",
	"0x6f5339034ca6bfbf1cde3795e516b656c4127318",
	"0x8fee346943a3556246a11902e6cc7d30ce480ee7",
	"0x9ad9ed137c033d8bb9802ce5021b131eaa858842",
	"0xee7f2d8257aa658c5895796f070e4046ba8fb37e",
	"0x0b864b3fb7771a582da793bfca21b0fb2683cd65",
	"0x8cedf3851577c80dec47d57bad8c9a5a9717528a",
	"0x72fc5abfe01e73759189cde8816592c2597dd3e9",
	"0x6bed4c5c1ed1d4ea47f79df5c111d7e9f56a122e",
	"0x30f5608b4ad36bd439916cfc5fe16b012a58a5e5"}

func (api *AudiusAPI) GetData() ([]*models.Bal, error) {
	var output []*models.Bal
	for i, a := range addresses {
		fmt.Printf("%v: ", i)
		b, _ := getBalance2(a)
		fmt.Println(b)
		output = append(output, b)
		db.AddAddress(models.Address{
			Address:           a,
			Network:           "eth",
			SignificantDigits: 9,
			Asset:             "0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998",
		})
		db.AddBalance("0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998", *b)

	}
	return output, nil
}

func getBalance2(address string) (*models.Bal, error) {
	a, _ := HttpRequest[models.AudiusResponse]("GET", "https://api.etherscan.io/api?module=account&action=tokenbalance&contractaddress=0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998&address="+address+"&tag=latest&apikey=IQUJGKFGQSEUQMB8EKB8II6YTSY22ATSA3", nil)
	for a != nil && a.Status != "1" {
		a, _ = HttpRequest[models.AudiusResponse]("GET", "https://api.etherscan.io/api?module=account&action=tokenbalance&contractaddress=0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998&address="+address+"&tag=latest&apikey=IQUJGKFGQSEUQMB8EKB8II6YTSY22ATSA3", nil)
	}
	balance := models.Bal{
		Address: address,
		Balance: a.Result,
	}

	return &balance, nil
}
